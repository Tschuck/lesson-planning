webpackJsonp([1],{"8xw6":function(e,t){},B4A8:function(e,t){e.exports={_lp:{cancel:"Abbrechen",class:{add:"Klasse hinzufügen",config:"Konfiguration",duplicate:"Duplizieren",empty:"Es wurden noch keine Klassen hinzufügt. Bitte fügen Sie eine Klasse hinzu.",multiple:"Klassen",name:"Name der Klasse",title:"Klasse"},close:"Schließen",days:{0:"Montag",1:"Dienstag",2:"Mittwoch",3:"Donnerstag",4:"Freitag"},delete:"Löschen","delete-long":"Wollen Sie wirklich fortfahren?",hour:"Stunde",lesson:{add:"Fach hinzufügen",empty:"Es wurden noch keine Fächer hinzufügt. Bitte fügen Sie ein Fach hinzu.",hours:"Stunden","lesson-ref":"Fach-Referenz",name:"Name des Faches",teachers:"Lehrer",title:"Fach"},school:{add:"Schule hinzufügen",export:"Schule exportieren",import:"Schule importieren","import-file":"Schule importieren","invalid-import":"Ungültige Datei",name:"Name der Schule",title:"Schule"},teachers:{add:"Lehrer hinzufügen",empty:"Es wurden noch kein Lehrer hinzufügt. Bitte fügen Sie einen Lehrer hinzu.",multiple:"Lehrer",name:"Name des Lehrers",teacher:"Lehrer",title:"Kollegium"},timetable:{create:"Stundenplan erstellen",generating:"Generiere Stundenplan...",missing:"Es wurde noch kein Stundenplan generiert, bitte erstellen Sie einen Neuen.",reset:"Stundenplan zurücksetzen","lock-lesson":"Stunde manuell festlegen",error:{title:"Fehler",invalid:"Ungültige Konfiguration der Stunden. Es konnte kein Stundenplan erstellt werden.",manual:"Für diese manuelle Konfiguration konnte kein Stundenplan gefunden werden. Die Änderung wurde rückgangig gemacht."}},title:"Stundenplanung"}}},MFwc:function(e,t){},Pqu3:function(e,t){},UpdR:function(e,t){e.exports={_lp:{cancel:"Cancel",class:{add:"Add class",config:"Configuration",duplicate:"Duplizieren",empty:"No classes have been added yet. Please add a class.",multiple:"Classes","not-selected":"Choose a class or add a new one.",title:"Class"},close:"Close",days:{0:"Monday",1:"Tuesday",2:"Wednesday",3:"Thursday",4:"Friday"},delete:"Delete","delete-long":"Do you realy want to continue?",hour:"Hour",lesson:{add:"Add lesson",empty:"No lesson have been added yet. Please add a lesson.",hours:"Hours","lesson-ref":"Lesson reference",name:"Name of lesson",teachers:"Teachers",title:"Lesson"},school:{add:"Add school",export:"Export school",import:"Import School","import-file":"Import School","invalid-import":"Invalid file",name:"Name of school",title:"School"},teachers:{add:"Add teacher",empty:"No teacher has been added yet. Please add a teacher.",multiple:"Teachers",name:"Teacher name",teacher:"Teacher",title:"Teachers"},timetable:{create:"Generate Timetable",generating:"Generating Timetable...",missing:"No Timetable was created before, please generate a new one.",reset:"Reset Timetable","lock-lesson":"Force lesson manually",error:{title:"Error",invalid:"Invalid configuration of the lessons. No timetable could be generated.",manual:"No timetable could be generated for this manual configuration. The change has been undone."}},title:"Lesson planning"}}},"b/Y3":function(e,t){},bPka:function(e,t){},fgy0:function(e,t){},iBW6:function(e,t){},lVK7:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("fZjL"),n=s.n(a),l=s("Tqaz"),r=s("T1ft"),o=s.n(r),i=s("7+uW"),c=s("NYxO"),d=s("kmDT"),h={name:"App",created:function(){document.title=this.$t("_lp.title")}},u={render:function(){var e=this.$createElement;return(this._self._c||e)("router-view",{key:this.$route.fullPath})},staticRenderFns:[]};var p=s("VU/8")(h,u,!1,function(e){s("bPka")},null,null).exports,f=s("/ocq"),v=s("mvHQ"),m=s.n(v),_=s("pFYg"),b=s.n(_),g=s("Zrlr"),y=s.n(g),x=s("wxAW"),w=s.n(x);var k={generateUID:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return""+e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},C=new(function(){function e(){var t=this;y()(this,e);try{this.schools=JSON.parse(window.localStorage.schools)}catch(e){this.schools=[]}this.schools.forEach(function(e){try{t[e]=JSON.parse(window.localStorage[e])}catch(s){t[e]={name:"invalid school",error:!0}}}),window.addEventListener("beforeunload",function(){return t.save()})}return w()(e,[{key:"addClass",value:function(e){var t=k.generateUID();return this[e].classes[t]={lessons:{},name:he.$t("_lp.class.title")+" - "+(n()(this[e].classes).length+1)},t}},{key:"addSchool",value:function(e){var t=k.generateUID();return this.schools.push(t),this[t]=e||{classes:{},lessons:{},name:he.$t("_lp.school.title")+" - "+this.schools.length,teachers:{}},t}},{key:"addLesson",value:function(e,t){var s=k.generateUID(),a=n()(this[e].classes[t].lessons).length;return this[e].classes[t].lessons[s]={hours:0,lessons:[],name:he.$t("_lp.lesson.title")+" "+(a+1),teachers:[]},s}},{key:"addTeacher",value:function(e){var t=k.generateUID(),s=n()(this[e].teachers).length;return this[e].teachers[t]={name:he.$t("_lp.teachers.teacher")+" "+(s+1),days:[[1,2,3,4,5,6],[1,2,3,4,5,6],[1,2,3,4,5,6],[1,2,3,4,5,6],[1,2,3,4,5,6]]},t}},{key:"deleteId",value:function(e){var t=this;this.schools.forEach(function(s){!function t(s,a){s&&(Array.isArray(s[a])?s[a].forEach(function(e){return t(e)}):"object"===b()(s[a])&&null!==s[a]&&n()(s[a]).forEach(function(e){return t(s[a],e)}),e===a&&(Array.isArray(s)?s.splice(s.indexOf(a),1):s&&s[a]&&delete s[a]))}(t,s),s===e&&(delete window.localStorage[e],t.schools.splice(t.schools.indexOf(e),1))})}},{key:"duplicate",value:function(e,t){var s=this[e],a=JSON.parse(m()(s.classes[t]));a.lessons={},n()(s.classes[t].lessons).forEach(function(e){var n=s.classes[t].lessons[e],l=JSON.parse(m()(n));l.teachers=[],l.lessons=[],a.lessons[k.generateUID()]=l});var l=k.generateUID();return this[e].classes[l]=a,l}},{key:"setTimetable",value:function(e,t){this[e].timetable=t}},{key:"save",value:function(){var e=this;window.localStorage.schools=m()(this.schools),this.schools.forEach(function(t){window.localStorage[t]=m()(e[t])})}}]),e}()),$={name:"Delete",data:function(){return{lessonPlanning:C}},props:["id","color"]},S={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("i",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mdi mdi-delete h4 ml-3 d-flex align-items-center mb-0 h-100",class:"text-"+e.color,attrs:{title:e.$t("_lp.delete")},on:{click:function(t){return e.$refs.deleteModal.show()}}}),e._v(" "),s("b-modal",{ref:"deleteModal",attrs:{title:e.$t("_lp.delete"),"hide-footer":""}},[s("p",{staticClass:"my-4"},[e._v("\n      "+e._s(e._f("translate")("_lp.delete-long"))+"\n    ")]),e._v(" "),s("div",{staticClass:"text-right"},[s("b-button",{staticClass:"mt-3",on:{click:function(t){return e.$refs.deleteModal.hide()}}},[e._v("\n        "+e._s(e._f("translate")("_lp.cancel"))+"\n      ")]),e._v(" "),s("b-button",{staticClass:"mt-3",attrs:{variant:"danger"},on:{click:function(t){e.$refs.deleteModal.hide(),e.lessonPlanning.deleteId(e.id),e.$emit("on-delete")}}},[e._v("\n        "+e._s(e._f("translate")("_lp.delete"))+"\n      ")])],1)])],1)},staticRenderFns:[]};var I=s("VU/8")($,S,!1,function(e){s("iBW6")},"data-v-8f769416",null).exports,E={render:function(){var e=this.$createElement,t=this._self._c||e;return t("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"primary"}},[t("b-navbar-brand",{staticClass:"d-flex align-items-center"},[t("router-link",{attrs:{to:"/"}},[t("svg",{attrs:{version:"1.0",xmlns:"http://www.w3.org/2000/svg",width:"40px",height:"40px",viewBox:"0 0 512.000000 512.000000",preserveAspectRatio:"xMidYMid meet"}},[t("g",{attrs:{transform:"translate(0.000000,512.000000) scale(0.100000,-0.100000)",fill:"#ffffff",stroke:"none"}},[t("path",{attrs:{d:"M2470 4136 c-71 -19 -2444 -857 -2457 -868 -7 -6 -13 -21 -13 -35 0\n        -19 9 -28 42 -43 24 -10 583 -229 1243 -485 1087 -424 1203 -467 1245 -463 27\n        3 489 178 1175 445 l1130 441 3 -551 2 -551 -36 -30 c-97 -79 -96 -223 0 -303\n        l37 -30 -15 -37 c-45 -108 -102 -395 -94 -476 17 -175 241 -236 352 -97 27 34\n        31 48 34 115 5 110 -49 364 -102 483 -5 10 1 20 19 29 14 8 39 34 55 59 25 37\n        30 54 30 106 0 51 -5 69 -28 104 -15 23 -38 48 -50 57 l-22 15 0 590 c0 424 3\n        594 11 608 8 12 9 23 2 36 -7 12 -384 149 -1237 450 -674 238 -1239 435 -1254\n        438 -15 3 -47 -1 -72 -7z"}}),this._v(" "),t("path",{attrs:{d:"M782 2358 c4 -348 6 -377 26 -438 139 -420 772 -737 1579 -789 399\n        -26 902 70 1260 239 305 145 500 327 577 538 19 53 20 84 24 441 3 314 1 383\n        -10 378 -522 -209 -1696 -657 -1721 -657 -21 0 -360 127 -882 330 -465 182\n        -849 330 -852 330 -3 0 -3 -168 -1 -372z"}})])])]),this._v(" "),t("div",{staticClass:"text-white ml-3"},[this._v("\n      "+this._s(this._f("translate")("_lp.title"))+"\n    ")])],1),this._v(" "),this._t("default")],2)},staticRenderFns:[]},O=s("VU/8")({name:"Header"},E,!1,null,null,null).exports,N={name:"Schools",components:{"lp-delete":I},data:function(){var e=C[this.$route.params.id];return{classes:n()(e.classes),school:e,teachers:n()(e.teachers)}},methods:{addTeacher:function(){var e=C.addTeacher(this.$route.params.id);this.teachers.push(e)},hide:function(){this.$hide()},show:function(){this.$refs.teacherModal.show()}}},L={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("b-modal",{ref:"teacherModal",attrs:{title:e.$t("_lp.teachers.title"),"hide-footer":"",size:"xl"}},[0===e.teachers.length?s("div",{staticClass:"text-center p-5"},[s("p",[e._v("\n        "+e._s(e._f("translate")("_lp.teachers.empty"))+"\n      ")]),e._v(" "),s("b-button",{staticClass:"mt-3",attrs:{variant:"primary"},on:{click:function(t){return e.addTeacher()}}},[e._v("\n        "+e._s(e._f("translate")("_lp.teachers.add"))+"\n      ")])],1):s("div",[s("table",{staticClass:"table border"},[s("thead",[s("tr",[s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.teachers.name")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.days.0")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.days.1")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.days.2")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.days.3")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.days.4")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}})])]),e._v(" "),s("tbody",[e._l(e.teachers,function(t,a){return s("tr",{key:t,staticClass:"bg-light"},[s("th",[s("b-form-input",{attrs:{placeholder:e.$t("_lp.teachers.name")},model:{value:e.school.teachers[t].name,callback:function(s){e.$set(e.school.teachers[t],"name",s)},expression:"school.teachers[teacher].name"}})],1),e._v(" "),e._l(e.school.teachers[t].days,function(a,n){return s("td",{key:n},[s("v-select",{attrs:{options:[1,2,3,4,5,6,7,8],multiple:""},on:{change:function(s){return e.$set(e.school.teachers[t].days,n,e.school.teachers[t].days[n])}},model:{value:e.school.teachers[t].days[n],callback:function(s){e.$set(e.school.teachers[t].days,n,s)},expression:"school.teachers[teacher].days[index]"}})],1)}),e._v(" "),s("td",[s("lp-delete",{attrs:{id:t,color:"dark"},on:{"on-delete":function(t){return e.teachers.splice(a,1)}}})],1)],2)}),e._v(" "),s("tr",[s("td",{staticClass:"text-right table-light border-top"},[s("b-button",{attrs:{variant:"primary"},on:{click:function(t){return e.addTeacher()}}},[e._v("\n                "+e._s(e._f("translate")("_lp.teachers.add"))+"\n              ")])],1),e._v(" "),s("td",{staticClass:"table-light border-top"}),e._v(" "),s("td",{staticClass:"table-light border-top"}),e._v(" "),s("td",{staticClass:"table-light border-top"}),e._v(" "),s("td",{staticClass:"table-light border-top"}),e._v(" "),s("td",{staticClass:"table-light border-top"}),e._v(" "),s("td",{staticClass:"table-light border-top"})])],2)])]),e._v(" "),s("div",{staticClass:"text-right"},[s("b-button",{staticClass:"mt-3",on:{click:function(t){return e.hide()}}},[e._v("\n        "+e._s(e._f("translate")("_lp.close"))+"\n      ")])],1)])],1)},staticRenderFns:[]};var M=s("VU/8")(N,L,!1,function(e){s("Pqu3")},"data-v-0e09c380",null).exports,T=s("Xxa5"),F=s.n(T),j=s("//Fk"),P=s.n(j),A=s("exGp"),z=s.n(A),D={name:"Timetable",props:["timetable","type"],data:function(){var e=0;this.timetable.plan.forEach(function(t){e<t.length&&(e=t.length)});var t=void 0;if(this.timetable.classId){var s=C[this.$route.params.id].classes[this.timetable.classId].lessons;t=n()(s).map(function(e){return{text:s[e].name,value:e}})}return{days:new Array(5),hours:new Array(e),lessonSelect:t,loading:!0,locked:{},teachers:C[this.$route.params.id].teachers}},created:function(){for(var e=0;e<5;e+=1){this.locked[e]={};for(var t=0;t<8;t+=1)this.timetable.plan[e][t]&&this.timetable.plan[e][t].locked&&(this.locked[e][t]=this.timetable.plan[e][t].lessonId)}this.loading=!1},methods:{changedManual:function(e,t){var s=this;return z()(F.a.mark(function a(){return F.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,new P.a(function(e){return setTimeout(e,200)});case 2:!0!==s.locked[e][t]&&s.$emit("update",{classId:s.timetable.classId,day:e,hour:t,lessonId:s.locked[e][t]});case 3:case"end":return a.stop()}},a,s)}))()}}},U={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"px-5 py-3"},[s("h3",[e._v(e._s(e.timetable.name))]),e._v(" "),e.loading?e._e():s("table",{staticClass:"table border"},[s("thead",[s("tr",[s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.hour")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.days.0")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.days.1")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.days.2")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.days.3")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.days.4")))])])]),e._v(" "),s("tbody",e._l(e.hours,function(t,a){return s("tr",{key:a,staticClass:"bg-light"},[s("th",[e._v(e._s(a+1))]),e._v(" "),e._l(e.days,function(t,n){return s("td",{key:n},[e.timetable.plan[n][a]?["class"===e.type?s("div",{staticClass:"d-flex"},[s("b-form-checkbox",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{title:e._f("translate")("_lp.timetable.lock-lesson"),"unchecked-value":null,value:!e.timetable.plan[n][a]||!e.timetable.plan[n][a].lessonId||e.timetable.plan[n][a].lessonId},on:{change:function(t){return e.changedManual(n,a)}},model:{value:e.locked[n][a],callback:function(t){e.$set(e.locked[n],a,t)},expression:"locked[day][hour]"}}),e._v(" "),s("div",[e.locked[n][a]?s("b-form-select",{attrs:{options:e.lessonSelect},on:{change:function(t){return e.changedManual(n,a)}},model:{value:e.locked[n][a],callback:function(t){e.$set(e.locked[n],a,t)},expression:"locked[day][hour]"}}):s("b",[e._v("\n                  "+e._s(e.timetable.plan[n][a].lessonName)+"\n                ")]),e._v(" "),e.timetable.plan[n][a].teachers?s("p",{staticClass:"mb-0"},e._l(e.timetable.plan[n][a].teachers,function(t){return s("span",{key:t},[e._v("\n                    "+e._s(e.teachers[t].name)+"\n                  ")])}),0):e._e()],1)],1):e._e(),e._v(" "),"teacher"===e.type?[s("b",[e._v(e._s(e.timetable.plan[n][a].className))]),e._v(" "),s("p",{staticClass:"mb-0"},[e._v("\n                "+e._s(e.timetable.plan[n][a].lessonName)+"\n              ")])]:e._e()]:"class"===e.type?s("div",[s("b-button",{staticClass:"mt-3",attrs:{variant:"primary"},on:{click:function(t){e.locked[n][a]=!0}}},[e._v("\n              "+e._s(e._f("translate")("_lp.timetable.lock-lesson"))+"\n            ")])],1):e._e()],2)})],2)}),0)])])},staticRenderFns:[]};var V=s("VU/8")(D,U,!1,function(e){s("n1wM")},"data-v-63129ce9",null).exports,R=s("Gu7T"),B=s.n(R),K=s("M4fF"),J=function(){return[[],[],[],[],[]]},W=function(){function e(t,s){var a=this;if(y()(this,e),s)n()(s).forEach(function(e){a[e]=s[e]});else{var l=C[t];this.blocked={},this.classes=l.classes,this.schoolId=t,this.teachers=l.teachers;var r=l.timetable||{};[].concat(B()(n()(this.classes)),B()(n()(this.teachers))).forEach(function(e){a[e]=r[e]||J()})}}return w()(e,[{key:"clone",value:function(){return new e(this.schoolId,JSON.parse(m()(this)))}},{key:"getFlat",value:function(){var e=this,t=[];return n()(this.classes).forEach(function(s){var a=e.classes[s];n()(a.lessons).forEach(function(e){for(var n=a.lessons[e],l=0;l<n.hours;l++)t.push({classId:s,lessonId:e,className:a.name,lessonName:n.name,lessons:n.lessons,teachers:n.teachers})})}),t}},{key:"update",value:function(){for(var e=this,t=this.clone(),s=t.getFlat(),a=n()(t.classes),l=0;l<a.length;l+=1)for(var r=a[l],o=0;o<5;o+=1)for(var i=0;i<8;i+=1){var c=t[r][o][i];if(c)if(c.locked){for(var d=!1,h=0;h<s.length;h+=1)if(s[h].lessonId===c.lessonId){d=!0,s.splice(h,1);break}if(!d)throw new Error("This lesson is not avaiable. Always locked!")}else t.revertLesson(t[r][o][i],{dayIndex:o,hourIndex:i})}for(var u=0;u<a.length;u+=1)for(var p=a[u],f=0;f<5;f+=1)for(var v=0;v<8;v+=1)t[p][f][v]&&console.log(t[p][f][v]);for(;s.length;){t.getLessonShifts(s[0]).forEach(function(e){var s=e.foundSlot,a=e.lesson;t.assignLesson(a,s)}),s.shift()}n()(this.classes).forEach(function(s){e[s]=Object(K.cloneDeep)(t[s])}),n()(this.teachers).forEach(function(s){e[s]=Object(K.cloneDeep)(t[s])}),this.save()}},{key:"getLessonShifts",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=this.getFreeLessonSlot(e);if(s)t.push({foundSlot:s,lesson:e});else for(var a=n()(this.classes),l=this.clone(),r=0;r<a.length;r+=1)for(var o=a[r],i=0;i<5;i+=1)for(var c=0;c<8;c+=1)if(!this.isSlotBlocked(o,i,c)){var d=this[o][i][c];if(d)if(l.revertLesson(d,{dayIndex:i,hourIndex:c}),s=l.getFreeLessonSlot(e)){l.assignLesson(e,s),l.setIsBlocked(o,i,c);var h=l.getLessonShifts(d,[].concat(B()(t),[{foundSlot:s,lesson:e}]));if(h)return h}else l.assignLesson(d,{dayIndex:i,hourIndex:c})}return t}},{key:"getFreeLessonSlot",value:function(e){for(var t=this,s=e.classId,a=e.lessonId,n=e.teachers,l=this[s],r=[].concat(l).sort(function(e,t){return e.length-t.length}),o=0,i=void 0,c=0,d=void 0;!d;){if(r[i=l.indexOf(r[o])].length>=8)throw new Error("Toooo many hours");var h=!0;if(this.isSlotBlocked(s,i,c)||l[i][c])h=!1;else l[i].filter(function(e){return e&&e.lessonId===a}).length>1?h=!1:n.forEach(function(e){var s=t.teachers[e],a=t[e][i];-1===s.days[i].indexOf(c+1)?h=!1:a[c]&&(h=!1)});if(h)d=!0;else if(5===++o){if(8===c)return null;o=0,c++}}return{dayIndex:i,hourIndex:c}}},{key:"assignLesson",value:function(e,t){var s=this,a=t.dayIndex,n=t.hourIndex;this[e.classId][a][n]=e,e.teachers.forEach(function(t){s[t][a][n]=e})}},{key:"revertLesson",value:function(e,t){var s=this,a=t.dayIndex,n=t.hourIndex;this[e.classId][a][n]=null,e.teachers.forEach(function(e){s[e][a][n]=null})}},{key:"serialize",value:function(){var e=this,t={};return n()(this.classes).forEach(function(s){t[s]=Object(K.cloneDeep)(e[s])}),n()(this.teachers).forEach(function(s){t[s]=Object(K.cloneDeep)(e[s])}),t}},{key:"save",value:function(){C.setTimetable(this.schoolId,this.serialize())}},{key:"setIsBlocked",value:function(e,t,s){this.blocked[e+"-"+t+"-"+s]=!0}},{key:"isSlotBlocked",value:function(e,t,s){return this[e][t][s]&&this[e][t][s].locked||this.blocked[e+"-"+t+"-"+s]}}]),e}(),G={name:"TimetableOverview",components:{"lp-timetable":V},data:function(){return{active:!1,activeView:0,generating:!1,plans:null,reloading:!1,tg:null}},methods:{toggle:function(){this.active=!this.active,this.active&&(this.tg=new W(this.$route.params.id),C[this.$route.params.id].timetable&&this.setPlans())},reset:function(){delete C[this.$route.params.id].timetable,this.tg=new W(this.$route.params.id),this.generateNewPlan()},generateNewPlan:function(e){var t=this;return z()(F.a.mark(function s(){var a,n,l,r,o,i,c,d,h,u;return F.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(a=!1,s.prev=1,e&&(n=e.classId,l=e.lessonId,r=e.day,o=e.hour,l?(t.tg[n][r][o]&&t.tg[n][r][o].lessonId===l&&(a=!0),i=C[t.$route.params.id].classes[n],c=i.lessons[l],t.tg.assignLesson({classId:n,className:i.name,lessonId:l,lessonName:c.name,lessons:c.lessons,locked:!0,teachers:c.teachers},{dayIndex:r,hourIndex:o})):t.tg.revertLesson(t.tg[n][r][o],{dayIndex:r,hourIndex:o})),a){s.next=9;break}return t.generating=!0,s.next=7,new P.a(function(e){return setTimeout(e,100)});case 7:t.tg.update(),t.setPlans();case 9:s.next=15;break;case 11:s.prev=11,s.t0=s.catch(1),console.error(s.t0.message),e?(d=e.classId,h=e.day,u=e.hour,t.tg.revertLesson(t.tg[d][h][u],{dayIndex:h,hourIndex:u}),t.generateNewPlan(),t.$bvModal.show("manual-error-modal")):t.$bvModal.show("error-modal");case 15:return t.reloading=!0,s.next=18,new P.a(function(e){return setTimeout(e,0)});case 18:t.reloading=!1,t.generating=!1;case 20:case"end":return s.stop()}},s,t,[[1,11]])}))()},setPlans:function(){var e=this;this.plans={classes:[],teachers:[]},n()(this.tg.classes).forEach(function(t){e.plans.classes.push({classId:t,name:e.tg.classes[t].name,plan:e.tg[t]})}),n()(this.tg.teachers).forEach(function(t){e.plans.teachers.push({teacherId:t,name:e.tg.teachers[t].name,plan:e.tg[t]})})}}},Y={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"timetable-overview",class:{active:e.active}},[s("div",{staticClass:"toggle",on:{click:function(t){return e.toggle()}}},[s("i",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mdi mdi-timetable h4 ml-3 d-flex text-white align-items-center mb-0 h-100",attrs:{title:e.$t("_lp.timetable.create")}})]),e._v(" "),s("b-modal",{attrs:{id:"error-modal"},scopedSlots:e._u([{key:"modal-title",fn:function(){return[e._v("\n      "+e._s(e._f("translate")("_lp.timetable.error.title"))+"\n    ")]},proxy:!0}])},[e._v(" "),s("div",{staticClass:"d-block text-center"},[e._v("\n      "+e._s(e._f("translate")("_lp.timetable.error.invalid"))+"\n    ")])]),e._v(" "),s("b-modal",{attrs:{id:"manual-error-modal"},scopedSlots:e._u([{key:"modal-title",fn:function(){return[e._v("\n      "+e._s(e._f("translate")("_lp.timetable.error.title"))+"\n    ")]},proxy:!0}])},[e._v(" "),s("div",{staticClass:"d-block text-center"},[e._v("\n      "+e._s(e._f("translate")("_lp.timetable.error.manual"))+"\n    ")])]),e._v(" "),s("b-overlay",{staticClass:"d-flex flex-column",staticStyle:{"max-height":"100%"},attrs:{show:e.generating}},[s("div",{staticClass:"py-1 px-5 d-flex border-bottom"},[s("div",{staticClass:"p-3",class:{"bg-primary text-light":0===e.activeView},on:{click:function(t){e.activeView=0}}},[e._v("\n        "+e._s(e._f("translate")("_lp.class.multiple"))+"\n      ")]),e._v(" "),s("div",{staticClass:"p-3",class:{"bg-primary text-light":1===e.activeView},on:{click:function(t){e.activeView=1}}},[e._v("\n        "+e._s(e._f("translate")("_lp.teachers.multiple"))+"\n      ")]),e._v(" "),s("span",{staticClass:"mx-auto"}),e._v(" "),e.plans?s("b-button",{staticClass:"mt-3",attrs:{variant:"danger"},on:{click:function(t){return e.reset()}}},[e._v("\n        "+e._s(e._f("translate")("_lp.timetable.reset"))+"\n      ")]):e._e()],1),e._v(" "),e.plans?s("div",{staticClass:"overflow-auto",staticStyle:{"min-height":"100%"}},[e.reloading?e._e():e._l(e.plans[0===e.activeView?"classes":"teachers"],function(t,a){return s("lp-timetable",{key:e.activeView+"-"+a,attrs:{timetable:t,type:0===e.activeView?"class":"teacher"},on:{update:function(t){return e.generateNewPlan(t)}}})})],2):s("div",{staticClass:"text-center p-5"},[s("h4",[e._v(e._s(e._f("translate")("_lp.timetable.missing")))]),e._v(" "),s("b-button",{staticClass:"mt-3",attrs:{variant:"primary"},on:{click:function(t){return e.generateNewPlan()}}},[e._v("\n        "+e._s(e._f("translate")("_lp.timetable.create"))+"\n      ")])],1)])],1)},staticRenderFns:[]};var q={name:"Schools",components:{"lp-delete":I,"lp-header":O,"lp-teachers":M,"lp-timetable-overview":s("VU/8")(G,Y,!1,function(e){s("8xw6")},"data-v-9e36a042",null).exports},data:function(){var e=C[this.$route.params.id];return{classes:n()(e.classes),school:e}},methods:{addClass:function(){var e=C.addClass(this.$route.params.id);this.classes.push(e),this.$router.push("/school/"+this.$route.params.id+"/"+e)},exportSchool:function(){var e="data:text/json;charset=utf-8, "+encodeURIComponent(m()(this.school)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download",this.school.name+".json"),document.body.appendChild(t),t.click(),t.remove()}}},H={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"h-100 d-flex flex-column"},[s("lp-header",[s("b-navbar-nav",{staticClass:"ml-auto d-flex"},[s("b-form-input",{staticStyle:{"max-width":"200px"},attrs:{placeholder:e.$t("_lp.school.name")},model:{value:e.school.name,callback:function(t){e.$set(e.school,"name",t)},expression:"school.name"}}),e._v(" "),s("div",[s("i",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mdi mdi-account-multiple h4 ml-3 d-flex text-white align-items-center mb-0 h-100",attrs:{title:e.$t("_lp.teachers.title")},on:{click:function(t){return e.$refs.teacherModal.show()}}})]),e._v(" "),s("div",[s("i",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mdi mdi-download h4 ml-3 d-flex text-white align-items-center mb-0 h-100",attrs:{title:e.$t("_lp.school.export")},on:{click:function(t){return e.exportSchool()}}})]),e._v(" "),s("lp-delete",{attrs:{id:this.$route.params.id,color:"white"},on:{"on-delete":function(t){return e.$router.push("/")}}})],1)],1),e._v(" "),s("div",{staticClass:"row",staticStyle:{height:"calc(100% - 66px)"}},[s("b-nav",{staticClass:"col-lg-2 col-md-3 border-right pr-0 overflow-auto flex-nowrap bg-light",staticStyle:{"max-height":"100%"},attrs:{vertical:""}},[e._l(e.classes,function(t){return s("b-nav-item",{key:t,staticClass:"border-bottom px-3 py-2",style:"border-right: "+(e.$route.params.classId===t?"5px solid #dcd1d8":"0"),attrs:{to:"/school/"+e.$route.params.id+"/"+t}},[e._v("\n        "+e._s(e.school.classes[t].name)+"\n      ")])}),e._v(" "),s("b-nav-item",{staticClass:"border-bottom px-3 py-2",on:{click:function(t){return e.addClass()}}},[s("i",{staticClass:"mdi mdi-plus"}),e._v("\n        "+e._s(e._f("translate")("_lp.class.add"))+"\n      ")])],2),e._v(" "),s("div",{staticClass:"col-lg-10 col-md-9 overflow-auto",staticStyle:{"max-height":"100%"}},[s("div",{staticClass:"p-4 h-100"},[e.$route.params.classId?s("router-view"):s("div",{staticClass:"text-center p-5"},[s("h5",[e._v("\n            "+e._s(e._f("translate")("_lp.class.empty"))+"\n          ")]),e._v(" "),s("b-button",{staticClass:"mt-3",attrs:{variant:"primary"},on:{click:function(t){return e.addClass()}}},[e._v("\n            "+e._s(e._f("translate")("_lp.class.add"))+"\n          ")])],1)],1)])],1),e._v(" "),s("lp-teachers",{ref:"teacherModal"}),e._v(" "),s("lp-timetable-overview")],1)},staticRenderFns:[]};var Z=s("VU/8")(q,H,!1,function(e){s("MFwc")},"data-v-13b2a576",null).exports,Q={name:"Schools",components:{"lp-header":O},data:function(){return{importError:!1,lessonPlanning:C,schools:C.schools}},methods:{importSchool:function(){var e=this,t=new FileReader;t.onload=function(t){try{var s=C.addSchool(JSON.parse(t.target.result));e.importError=!1,e.$refs.importModal.hide(),e.$router.push("/school/"+s)}catch(t){console.error(t.message),e.importError=!0}},t.readAsText(this.$refs.schoolImport.files[0])}}},X={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("lp-header",[s("b-navbar-nav",{staticClass:"ml-auto d-flex"},[s("div",[s("i",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mdi mdi-plus-circle h4 ml-3 d-flex text-white align-items-center mb-0 h-100",attrs:{title:e.$t("_lp.school.add")},on:{click:function(t){return e.lessonPlanning.addSchool()}}})]),e._v(" "),s("div",[s("i",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mdi mdi-upload h4 ml-3 d-flex text-white align-items-center mb-0 h-100",attrs:{title:e.$t("_lp.school.import")},on:{click:function(t){return e.$refs.importModal.show()}}})])])],1),e._v(" "),s("b-modal",{ref:"importModal",attrs:{title:e.$t("_lp.school.import"),"hide-footer":""}},[s("div",{staticClass:"custom-file"},[s("input",{ref:"schoolImport",staticClass:"custom-file-input",attrs:{accept:".json",id:"schoolImport",type:"file"},on:{change:function(t){return e.importSchool()}}}),e._v(" "),e.importError?s("p",{staticClass:"text-danger"},[e._v("\n          "+e._s(e._f("translate")("_lp.school.invalid-import"))+"\n        ")]):e._e(),e._v(" "),s("label",{staticClass:"custom-file-label",attrs:{for:"schoolImport"}},[e._v("\n        "+e._s(e._f("translate")("_lp.school.import-file"))+"\n      ")])]),e._v(" "),s("div",{staticClass:"text-right"},[s("b-button",{staticClass:"mt-3",on:{click:function(t){return e.$refs.importModal.hide()}}},[e._v("\n        "+e._s(e._f("translate")("_lp.close"))+"\n      ")])],1)]),e._v(" "),s("div",{staticClass:"container"},[s("div",{staticClass:"row"},e._l(e.schools,function(t){return s("router-link",{key:t,staticClass:"col-md-3 p-3",attrs:{event:e.lessonPlanning[t].error?"":"click",to:"school/"+t}},[s("b-card",{class:{"bg-danger text-white":e.lessonPlanning[t].error},staticStyle:{height:"80px"}},[s("b-card-title",{staticClass:"mb-0 d-flex align-items-center",staticStyle:{height:"100%"}},[s("h4",{staticClass:"mb-0"},[e._v(e._s(e.lessonPlanning[t].name))])])],1)],1)}),1)])],1)},staticRenderFns:[]};var ee=s("VU/8")(Q,X,!1,function(e){s("fgy0")},"data-v-d41d139c",null).exports,te={name:"Schools",components:{"lp-delete":I,"lp-header":O},data:function(){var e=C[this.$route.params.id].classes[this.$route.params.classId];return{classObj:e,lessonPlanning:C,lessons:n()(e.lessons),school:C[this.$route.params.id]}},methods:{addLesson:function(){var e=C.addLesson(this.$route.params.id,this.$route.params.classId);this.lessons.push(e)},duplicate:function(){var e=C.duplicate(this.$route.params.id,this.$route.params.classId);this.$router.push("/school/"+this.$route.params.id+"/"+e)},teacherOptions:function(){var e=C[this.$route.params.id],t=e.teachers;return n()(t).map(function(t){return{label:e.teachers[t].name,key:t}})},classReferenceOptions:function(){var e=C[this.$route.params.id].classes,t=[];return n()(e).forEach(function(s){return n()(e[s].lessons).forEach(function(a){return t.push({label:e[s].name+" - "+e[s].lessons[a].name,key:a})})}),t}}},se={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"bg-light h-100 border shadow d-flex flex-column"},[s("div",{staticClass:"d-flex align-items-center pt-4 px-4"},[s("h4",{staticClass:"mb-0"},[e._v(e._s(e._f("translate")("_lp.class.config")))]),e._v(" "),s("div",{staticClass:"ml-auto d-flex"},[s("b-form-input",{staticStyle:{"max-width":"200px"},attrs:{placeholder:e.$t("_lp.class.name")},model:{value:e.classObj.name,callback:function(t){e.$set(e.classObj,"name",t)},expression:"classObj.name"}}),e._v(" "),s("div",[s("i",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"mdi mdi-content-copy h4 ml-3 d-flex text-dark align-items-center mb-0 h-100",attrs:{title:e.$t("_lp.class.duplicate")},on:{click:function(t){return e.duplicate()}}})]),e._v(" "),s("lp-delete",{attrs:{id:this.$route.params.classId,color:"dark"},on:{"on-delete":function(t){return e.$router.push("/school/"+e.$route.params.id)}}})],1)]),e._v(" "),s("div",{staticClass:"overflow-auto"},[0===e.lessons.length?s("div",{staticClass:"text-center p-5"},[s("h5",[e._v("\n        "+e._s(e._f("translate")("_lp.lesson.empty"))+"\n      ")]),e._v(" "),s("b-button",{staticClass:"mt-3",attrs:{variant:"primary"},on:{click:function(t){return e.addLesson()}}},[e._v("\n        "+e._s(e._f("translate")("_lp.lesson.add"))+"\n      ")])],1):s("div",{staticClass:"p-4"},[s("table",{staticClass:"table border"},[s("thead",[s("tr",[s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.lesson.title")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.lesson.hours")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.lesson.teachers")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}},[e._v(e._s(e._f("translate")("_lp.lesson.lesson-ref")))]),e._v(" "),s("th",{staticClass:"bg-white",attrs:{scope:"col"}})])]),e._v(" "),s("tbody",[e._l(e.lessons,function(t,a){return s("tr",{key:t},[s("th",[s("b-form-input",{staticStyle:{"max-width":"300px"},attrs:{placeholder:e.$t("_lp.class.name")},model:{value:e.classObj.lessons[t].name,callback:function(s){e.$set(e.classObj.lessons[t],"name",s)},expression:"classObj.lessons[lesson].name"}})],1),e._v(" "),s("td",[s("b-form-input",{staticStyle:{width:"80px"},attrs:{placeholder:e.$t("_lp.class.name")},model:{value:e.classObj.lessons[t].hours,callback:function(s){e.$set(e.classObj.lessons[t],"hours",s)},expression:"classObj.lessons[lesson].hours"}})],1),e._v(" "),s("td",[s("v-select",{staticStyle:{"max-width":"300px"},attrs:{options:e.teacherOptions(),multiple:"",reduce:function(e){return e.key}},on:{change:function(s){return e.$set(e.classObj.lessons[t],"teachers",e.classObj.lessons[t].teachers)}},model:{value:e.classObj.lessons[t].teachers,callback:function(s){e.$set(e.classObj.lessons[t],"teachers",s)},expression:"classObj.lessons[lesson].teachers"}})],1),e._v(" "),s("td",[s("v-select",{staticStyle:{"max-width":"300px"},attrs:{options:e.classReferenceOptions(),multiple:"",reduce:function(e){return e.key}},on:{change:function(s){return e.$set(e.classObj.lessons[t],"lessons",e.classObj.lessons[t].lessons)}},model:{value:e.classObj.lessons[t].lessons,callback:function(s){e.$set(e.classObj.lessons[t],"lessons",s)},expression:"classObj.lessons[lesson].lessons"}})],1),e._v(" "),s("td",[s("lp-delete",{attrs:{id:t,color:"dark"},on:{"on-delete":function(t){return e.lessons.splice(a,1)}}})],1)])}),e._v(" "),s("tr",[s("td",{staticClass:"bg-white text-right"},[s("b-button",{attrs:{variant:"primary"},on:{click:function(t){return e.addLesson()}}},[e._v("\n                "+e._s(e._f("translate")("_lp.lesson.add"))+"\n              ")])],1),e._v(" "),s("td",{staticClass:"bg-white"}),e._v(" "),s("td",{staticClass:"bg-white"}),e._v(" "),s("td",{staticClass:"bg-white"}),e._v(" "),s("td",{staticClass:"bg-white"})])],2)])])])])},staticRenderFns:[]};var ae=s("VU/8")(te,se,!1,function(e){s("b/Y3")},"data-v-2b48f6fe",null).exports;i.default.use(f.a);var ne=new f.a({mode:"hash",routes:[{path:"",redirect:"schools"},{path:"/schools",name:"schools",component:ee},{path:"/school/:id",component:Z,beforeEnter:function(e,t,s){C[e.params.id]?s():s("/schools")},children:[{path:"",component:ae,beforeEnter:function(e,t,s){var a=e.params.id,l=n()(C[a].classes);l.length>0?s(e.path+"/"+l[0]):s()}},{path:":classId",name:"school-class",component:ae,beforeEnter:function(e,t,s){C[e.params.id].classes[e.params.classId]?s():s(e.path.replace("/"+e.params.classId,""))}}]}]}),le=s("B4A8"),re=s.n(le),oe=s("UpdR"),ie=s.n(oe),ce={de:re.a,en:ie.a};i.default.config.productionTip=!1,i.default.component("v-select",o.a),i.default.use(l.a),i.default.use(c.a);var de=new c.a.Store({state:{},strict:!1});i.default.use(d.a.plugin,de),n()(ce).forEach(function(e){return i.default.i18n.add(e,ce[e])}),i.default.i18n.set("de");var he=t.default=new i.default({components:{App:p},el:"#app",router:ne,store:de,template:"<App/>"})},n1wM:function(e,t){}},["lVK7"]);
//# sourceMappingURL=app.13f6ea5f196b8e634ac7.js.map